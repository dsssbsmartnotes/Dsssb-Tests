<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DSSSB CBT Professional Portal (Pro)</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$']] },
  svg: { fontCache: 'global' },
  startup: { typeset: false }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* =========================
   CORE THEME & VARIABLES
   ========================= */
:root {
  --primary: #2563eb;       /* Modern Blue */
  --primary-dark: #1e40af;
  --success: #16a34a;
  --danger: #dc2626;
  --warning: #ca8a04;
  --bg-body: #f1f5f9;
  --bg-card: #ffffff;
  --text-main: #1e293b;
  --text-muted: #64748b;
  --border-color: #e2e8f0;
  --header-height: 60px;
}

body.dark-mode {
  --primary: #60a5fa;
  --primary-dark: #3b82f6;
  --success: #4ade80;
  --danger: #f87171;
  --bg-body: #0f172a;
  --bg-card: #1e293b;
  --text-main: #f1f5f9;
  --text-muted: #94a3b8;
  --border-color: #334155;
}

* { box-sizing: border-box; outline: none; }
html, body { width: 100%; height: 100%; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-body); color: var(--text-main); overflow: hidden; user-select: none; }
body { display: grid; grid-template-rows: var(--header-height) auto 1fr auto; }

/* --- TOAST NOTIFICATIONS --- */
#toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; align-items: center; pointer-events: none; }
.toast { background: rgba(30, 41, 59, 0.95); color: #fff; padding: 12px 24px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px; font-size: 14px; animation: slideUp 0.3s ease-out; pointer-events: auto; backdrop-filter: blur(4px); min-width: 300px; border-left: 4px solid var(--primary); }
.toast.success { border-color: var(--success); }
.toast.error { border-color: var(--danger); }
.toast.warning { border-color: var(--warning); }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* --- LOGIN SCREEN --- */
.full-overlay { position: fixed; inset: 0; background: var(--bg-body); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
.login-card { background: var(--bg-card); padding: 40px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; border: 1px solid var(--border-color); }
.login-input { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-body); color: var(--text-main); font-size: 16px; transition: 0.2s; }
.login-input:focus { border-color: var(--primary); }
.btn-primary { background: var(--primary); color: #fff; border: none; padding: 14px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; margin-top: 15px; }
.btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }
.btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }

/* --- HEADER --- */
header { background: var(--bg-card); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 50; }
.brand { font-weight: 800; font-size: 20px; color: var(--primary); display: flex; align-items: center; gap: 8px; }
.timer-badge { background: rgba(37, 99, 235, 0.1); color: var(--primary); padding: 6px 12px; border-radius: 6px; font-weight: bold; font-family: monospace; font-size: 18px; border: 1px solid rgba(37, 99, 235, 0.2); }
.timer-badge.low { background: rgba(220, 38, 38, 0.1); color: var(--danger); border-color: var(--danger); animation: pulse 1s infinite; }

/* --- SECTION BAR --- */
#sectionBar { background: var(--bg-card); border-bottom: 1px solid var(--border-color); display: flex; overflow-x: auto; scrollbar-width: none; }
.sec-tab { padding: 12px 20px; font-size: 14px; font-weight: 600; color: var(--text-muted); cursor: not-allowed; border-bottom: 3px solid transparent; white-space: nowrap; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
.sec-tab.active { color: var(--primary); border-bottom-color: var(--primary); background: rgba(37, 99, 235, 0.05); cursor: default; }
.sec-tab.done { color: var(--success); opacity: 0.8; }

/* --- MAIN LAYOUT --- */
#mainArea { padding: 20px; overflow-y: auto; display: none; position: relative; }
.q-card { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color); padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 20px; }
.q-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; font-size: 14px; color: var(--text-muted); }
.q-text { font-size: 18px; line-height: 1.6; margin-bottom: 20px; font-weight: 500; }
.opt { display: flex; align-items: center; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; background: var(--bg-card); }
.opt:hover { background: var(--bg-body); border-color: var(--primary); }
.opt.sel { background: rgba(37, 99, 235, 0.1); border-color: var(--primary); font-weight: 600; }
.opt.correct { background: rgba(22, 163, 74, 0.15); border-color: var(--success); }
.opt.wrong { background: rgba(220, 38, 38, 0.15); border-color: var(--danger); }
.opt-badge { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 12px; font-weight: bold; flex-shrink: 0; }
.opt.sel .opt-badge { background: var(--primary); border-color: var(--primary); color: #fff; }

/* --- FOOTER & PALETTE --- */
footer { background: var(--bg-card); padding: 10px 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; gap: 10px; display: none; z-index: 40; }
.nav-btn { padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main); }
.nav-btn.primary { background: var(--primary); color: #fff; border: none; }

#palettePanel { position: fixed; top: 0; right: -320px; width: 300px; height: 100%; background: var(--bg-card); border-left: 1px solid var(--border-color); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100; display: flex; flex-direction: column; box-shadow: -5px 0 25px rgba(0,0,0,0.1); }
#palettePanel.show { right: 0; }
.p-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; padding: 15px; overflow-y: auto; flex: 1; align-content: start; }
.qbtn { aspect-ratio: 1; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-body); font-weight: 600; font-size: 12px; cursor: pointer; color: var(--text-main); }
.qbtn.current { border: 2px solid var(--text-main); }
.qbtn.answered { background: var(--success); color: #fff; border: none; }
.qbtn.review { background: var(--primary); color: #fff; border: none; }

/* --- MODALS --- */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1500; display: none; backdrop-filter: blur(2px); justify-content: center; align-items: center; }
.modal-card { background: var(--bg-card); width: 90%; max-width: 800px; max-height: 90vh; border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
.modal-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 18px; }
.modal-body { padding: 20px; overflow-y: auto; }

/* --- ANALYTICS DASHBOARD --- */
.dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.stat-box { background: var(--bg-body); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center; }
.big-num { font-size: 32px; font-weight: 800; color: var(--primary); }
.chart-wrapper { position: relative; height: 250px; }
.sol-section { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
.sol-section:last-child { border: none; }
.sol-label { font-size: 12px; font-weight: bold; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; display: block; }

@media(max-width: 768px) {
  .dashboard-grid { grid-template-columns: 1fr; }
  #palettePanel { width: 85%; }
  footer { display: grid; grid-template-columns: 1fr 1fr; }
  .btn-grid { grid-column: span 2; }
}
</style>
</head>

<body onload="initApp()">

<div id="toast-container"></div>

<div id="startScreen" class="full-overlay">
    <div class="login-card">
        <div style="font-size:40px; margin-bottom:10px;">üéì</div>
        <h2 style="margin:0 0 10px 0; color:var(--primary);">DSSSB Pro Portal</h2>
        <p style="color:var(--text-muted); font-size:14px; margin-bottom:20px;">Secure Computer Based Test System</p>
        
        <input type="text" id="startNameInput" class="login-input" placeholder="Enter Full Name">
        <input type="password" id="examPassInput" class="login-input" placeholder="Password (default: dsssb2406)">
        
        <div id="resumeBox" style="display:none; margin-top:15px; background:rgba(255,165,0,0.1); padding:10px; border-radius:6px; border:1px solid orange; color:orange; font-size:13px; text-align:left;">
            <b>‚ö†Ô∏è Incomplete Test Found</b><br>
            A previous session was interrupted. 
            <div style="margin-top:8px; display:flex; gap:10px;">
                <button onclick="loadState()" style="padding:5px 10px; background:orange; color:white; border:none; border-radius:4px; cursor:pointer;">Resume</button>
                <button onclick="clearState()" style="padding:5px 10px; background:none; border:1px solid orange; color:orange; border-radius:4px; cursor:pointer;">New Test</button>
            </div>
        </div>

        <button class="btn-primary" onclick="validateLogin()">START EXAM</button>
    </div>
</div>

<header>
    <div class="brand"><span>üõ°Ô∏è</span> DSSSB CBT</div>
    <div style="display:flex; gap:10px; align-items:center;">
        <div id="timer" class="timer-badge">120:00</div>
        <button class="nav-btn" onclick="toggleTheme()">üåô</button>
        <button class="nav-btn" onclick="toggleLang()" id="langBtn">HI</button>
        <button class="nav-btn" onclick="toggleFS()">‚õ∂</button>
    </div>
</header>

<div id="sectionBar"></div>

<div id="mainArea">
    <div class="q-card">
        <div class="q-header">
            <span>Question <b id="qNumDisp">1</b></span>
            <span>Marks: <span style="color:var(--success)">+1.0</span> / <span style="color:var(--danger)">-0.25</span></span>
        </div>
        
        <div id="qContent" class="q-text"></div>
        
        <div id="opts"></div>

        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="nav-btn" style="border-color:var(--warning); color:var(--warning);" onclick="markReview()">‚≠ê Mark for Review</button>
            <button class="nav-btn" onclick="clearResponse()">Clear Response</button>
        </div>

        <div id="expBox" style="display:none; margin-top:20px; padding:15px; background:rgba(22, 163, 74, 0.1); border-left:4px solid var(--success); border-radius:6px;"></div>
    </div>
</div>

<div id="palettePanel">
    <div class="modal-header" style="background:var(--bg-body);">
        <span>Question Palette</span>
        <button onclick="togglePalette()" style="border:none; background:none; font-size:24px;">&times;</button>
    </div>
    <div class="p-grid" id="paletteGrid"></div>
    <div style="padding:15px; border-top:1px solid var(--border-color);">
        <button id="mainSubmitBtn" onclick="submitTest()" class="btn-primary" style="background:var(--danger); display:none;">SUBMIT FINAL EXAM</button>
    </div>
</div>

<div id="resultModal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <span>üèÜ Score Card</span>
            <button onclick="closeResult()" style="border:none; background:none; font-size:20px;">&times;</button>
        </div>
        <div class="modal-body" id="resultContent">
            </div>
    </div>
</div>

<footer>
    <button class="nav-btn btn-grid" onclick="togglePalette()">Grid</button>
    <div style="flex:1"></div>
    <button class="nav-btn" onclick="prev()">Previous</button>
    <button class="nav-btn primary" id="nextBtn" onclick="next()">Next</button>
</footer>

<script>
/* =========================================
   1. ADVANCED CONFIGURATION
   ========================================= */
const PASS_ENCODED = "ZHNzc2IyNDA2"; 
const TOTAL_TIME_MINS = 120;
const STORAGE_KEY = "dsssb_pro_state_v2";

const SECTIONS = ["Reasoning", "GK", "Maths", "English", "Hindi"];
const SECTION_MAP = [
    "Reasoning 1", "Reasoning 2",
    "GK 1", "GK 2",
    "Maths 1", "Maths 2",
    "English 1", "English 2",
    "Hindi 1", "Hindi 2"
];

// --- UPDATED BILINGUAL DATA WITH HTML SOLUTIONS ---
const QUESTIONS = [
  // REASONING 1
  { 
      section:"Reasoning 1", 
      q_en:"Complete the series: 2, 6, 12, 20, ?", 
      q_hi:"‡§∂‡•ç‡§∞‡•É‡§Ç‡§ñ‡§≤‡§æ ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç: 2, 6, 12, 20, ?", 
      ans:"1", 
      op_en:["30","32","34","36"], 
      op_hi:["30","32","34","36"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">English</span>
        The pattern follows consecutive even numbers addition: <br>
        2 + 4 = 6<br>6 + 6 = 12<br>12 + 8 = 20<br>20 + 10 = <b>30</b>
      </div>
      <div class="sol-section">
        <span class="sol-label">Hindi</span>
        ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§∏‡§Æ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡§æ ‡§π‡•à: <br>
        2 + 4 = 6<br>6 + 6 = 12<br>12 + 8 = 20<br>20 + 10 = <b>30</b>
      </div>` 
  },
  { 
      section:"Reasoning 1", 
      q_en:"Statements: All Pens are Cups. Conclusion: Some Cups are Pens.", 
      q_hi:"‡§ï‡§•‡§®: ‡§∏‡§≠‡•Ä ‡§™‡•á‡§® ‡§ï‡§™ ‡§π‡•à‡§Ç‡•§ ‡§®‡§ø‡§∑‡•ç‡§ï‡§∞‡•ç‡§∑: ‡§ï‡•Å‡§õ ‡§ï‡§™ ‡§™‡•á‡§® ‡§π‡•à‡§Ç‡•§", 
      ans:"1", 
      op_en:["True","False","Cannot Say","None"], 
      op_hi:["‡§∏‡§§‡•ç‡§Ø","‡§Ö‡§∏‡§§‡•ç‡§Ø","‡§ï‡§π‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ","‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">English</span>
        If All A are B, then Some B are definitely A. Hence True.
      </div>
      <div class="sol-section">
        <span class="sol-label">Hindi</span>
        ‡§Ø‡§¶‡§ø ‡§∏‡§≠‡•Ä A, B ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§ï‡•Å‡§õ B ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á A ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§§‡§É ‡§∏‡§§‡•ç‡§Ø ‡§π‡•à‡•§
      </div>` 
  },
  
  // REASONING 2
  { 
      section:"Reasoning 2", 
      q_en:"Find the odd one out:", 
      q_hi:"‡§µ‡§ø‡§∑‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç:", 
      ans:"3", 
      op_en:["Car","Bus","Airplane","Truck"], 
      op_hi:["Car","Bus","Airplane","Truck"], 
      solution:`
      <div class="sol-section"><span class="sol-label">English</span> Airplane flies in the air, others run on roads.</div>
      <div class="sol-section"><span class="sol-label">Hindi</span> ‡§π‡§µ‡§æ‡§à ‡§ú‡§π‡§æ‡§ú ‡§π‡§µ‡§æ ‡§Æ‡•á‡§Ç ‡§â‡§°‡§º‡§§‡§æ ‡§π‡•à, ‡§¨‡§æ‡§ï‡•Ä ‡§∏‡§°‡§º‡§ï ‡§™‡§∞ ‡§ö‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§</div>` 
  },
  { 
      section:"Reasoning 2", 
      q_en:"Coding: CAT = 24, DOG = ?", 
      q_hi:"Coding: CAT = 24, DOG = ?", 
      ans:"2", 
      op_en:["20","26","25","30"], 
      op_hi:["20","26","25","30"], 
      solution:`
      <div class="sol-section"><span class="sol-label">Solution</span> C(3)+A(1)+T(20)=24.<br>D(4)+O(15)+G(7)=<b>26</b>.</div>` 
  },

  // GK 1
  { 
      section:"GK 1", 
      q_en:"What is the capital of India?", 
      q_hi:"‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", 
      ans:"1", 
      op_en:["New Delhi","Mumbai","Kolkata","Chennai"], 
      op_hi:["‡§®‡§à ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä","‡§Æ‡•Å‡§Ç‡§¨‡§à","‡§ï‡•ã‡§≤‡§ï‡§æ‡§§‡§æ","‡§ö‡•á‡§®‡•ç‡§®‡§à"], 
      solution:`
      <div class="sol-section"><span class="sol-label">English</span> New Delhi became the capital in 1911.</div>
      <div class="sol-section"><span class="sol-label">Hindi</span> 1911 ‡§Æ‡•á‡§Ç ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä ‡§ï‡§≤‡§ï‡§§‡•ç‡§§‡§æ ‡§∏‡•á ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡•Ä ‡§ó‡§à ‡§•‡•Ä‡•§</div>` 
  },
  { 
      section:"GK 1", 
      q_en:"Who is known as the Father of Constitution?", 
      q_hi:"‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§ï‡§æ ‡§™‡§ø‡§§‡§æ ‡§ï‡§ø‡§∏‡•á ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?", 
      ans:"2", 
      op_en:["Gandhi Ji","Ambedkar Ji","Nehru Ji","Patel Ji"], 
      op_hi:["‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§ú‡•Ä","‡§Ö‡§Æ‡•ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ú‡•Ä","‡§®‡•á‡§π‡§∞‡•Ç ‡§ú‡•Ä","‡§™‡§ü‡•á‡§≤ ‡§ú‡•Ä"], 
      solution:`
      <div class="sol-section"><span class="sol-label">English</span> Dr. B.R. Ambedkar is the chief architect of the Indian Constitution.</div>
      <div class="sol-section"><span class="sol-label">Hindi</span> ‡§°‡•â. ‡§¨‡•Ä.‡§Ü‡§∞. ‡§Ö‡§Æ‡•ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡•ã ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§æ‡§∏‡•ç‡§§‡•Å‡§ï‡§æ‡§∞ ‡§Æ‡§æ‡§®‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§</div>` 
  },

  // MATHS 1
  { 
      section:"Maths 1", 
      q_en:"Solve: $ 25\\% \\text{ of } 200 + 40 $", 
      q_hi:"‡§π‡§≤ ‡§ï‡§∞‡•á‡§Ç: $ 25\\% \\text{ of } 200 + 40 $", 
      ans:"2", 
      op_en:["80","90","100","110"], 
      op_hi:["80","90","100","110"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">Solution</span>
        $$ \\frac{25}{100} \\times 200 = 50 $$
        $$ 50 + 40 = 90 $$
      </div>` 
  },
  { 
      section:"Maths 1", 
      q_en:"Find x: $ 2x + 10 = 30 $", 
      q_hi:"x ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç: $ 2x + 10 = 30 $", 
      ans:"1", 
      op_en:["10","15","20","5"], 
      op_hi:["10","15","20","5"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">Solution</span>
        $$ 2x = 30 - 10 $$
        $$ 2x = 20 \\Rightarrow x = 10 $$
      </div>` 
  },

  // MATHS 2
  { 
      section:"Maths 2", 
      q_en:"Value of $ \\int_0^1 x^2 dx $", 
      q_hi:"$ \\int_0^1 x^2 dx $ ‡§ï‡§æ ‡§Æ‡§æ‡§®:", 
      ans:"2", 
      op_en:["1","$1/3$","$1/2$","0"], 
      op_hi:["1","$1/3$","$1/2$","0"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">Solution</span>
        $$ \\left[ \\frac{x^3}{3} \\right]_0^1 = \\frac{1}{3} - 0 = \\frac{1}{3} $$
      </div>` 
  },
  { 
      section:"Maths 2", 
      q_en:"Area of circle with radius 7?", 
      q_hi:"7 ‡§§‡•ç‡§∞‡§ø‡§ú‡•ç‡§Ø‡§æ ‡§µ‡§æ‡§≤‡•á ‡§µ‡•É‡§§‡•ç‡§§ ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§´‡§≤?", 
      ans:"1", 
      op_en:["154","144","132","100"], 
      op_hi:["154","144","132","100"], 
      solution:`
      <div class="sol-section">
        <span class="sol-label">Solution</span>
        $$ Area = \\pi r^2 = \\frac{22}{7} \\times 7 \\times 7 = 154 $$
      </div>` 
  },

  // ENGLISH 1
  { 
      section:"English 1", 
      q_en:"Synonym of 'Abundant'", 
      q_hi:"Synonym of 'Abundant'", 
      ans:"3", 
      op_en:["Scarce","Small","Plentiful","Weak"], 
      op_hi:["Scarce","Small","Plentiful","Weak"], 
      solution:`
      <div class="sol-section"><span class="sol-label">English</span> Abundant means available in large quantities. Synonym is Plentiful.</div>
      <div class="sol-section"><span class="sol-label">Hindi</span> Abundant ‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à ‡§™‡•ç‡§∞‡§ö‡•Å‡§∞ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§Æ‡•á‡§Ç‡•§ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡§µ‡§æ‡§ö‡•Ä Plentiful ‡§π‡•à‡•§</div>` 
  },
  
  // HINDI 1
  { 
      section:"Hindi 1", 
      q_en:"'‡§ï‡§Æ‡§≤' ‡§ï‡§æ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡§µ‡§æ‡§ö‡•Ä:", 
      q_hi:"'‡§ï‡§Æ‡§≤' ‡§ï‡§æ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡§µ‡§æ‡§ö‡•Ä:", 
      ans:"1", 
      op_en:["‡§™‡§Ç‡§ï‡§ú","‡§ú‡§≤‡§¶","‡§®‡•Ä‡§∞‡§¶","‡§™‡§µ‡§®"], 
      op_hi:["‡§™‡§Ç‡§ï‡§ú","‡§ú‡§≤‡§¶","‡§®‡•Ä‡§∞‡§¶","‡§™‡§µ‡§®"], 
      solution:`
      <div class="sol-section"><span class="sol-label">Hindi</span> ‡§™‡§Ç‡§ï‡§ú ‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à ‡§ï‡•Ä‡§ö‡§°‡§º ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡§æ, ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§ ‡§ï‡§Æ‡§≤‡•§</div>` 
  }
];

/* STATE MANAGEMENT */
let currentState = {
    idx: 0,
    answers: new Array(QUESTIONS.length).fill(null),
    review: new Array(QUESTIONS.length).fill(false),
    time: TOTAL_TIME_MINS * 60,
    secIdx: 0,
    submitted: false,
    name: ""
};

let timerInt;
let secIndices = [];

/* =========================================
   2. INITIALIZATION & LOGIN
   ========================================= */
function initApp() {
    calcSectionIndices();
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved) document.getElementById('resumeBox').style.display = 'block';
}

function calcSectionIndices() {
    SECTION_MAP.forEach(sec => {
        const start = QUESTIONS.findIndex(q => q.section === sec);
        if(start !== -1) secIndices.push(start);
        else secIndices.push(0);
    });
}

function validateLogin() {
    const name = document.getElementById('startNameInput').value.trim();
    const pass = document.getElementById('examPassInput').value.trim();
    if(!name) return showToast("Please enter your name", "error");
    if(btoa(pass) !== PASS_ENCODED) return showToast("Invalid Password!", "error");
    currentState.name = name;
    startGame(false);
}

function startGame(isResuming) {
    document.getElementById('startScreen').style.display = 'none';
    document.querySelector('header').style.display = 'flex';
    document.getElementById('mainArea').style.display = 'block';
    document.querySelector('footer').style.display = 'flex';
    renderSectionTabs();
    if(!isResuming) currentState.idx = secIndices[0];
    loadQuestion(currentState.idx);
    startTimer();
    setInterval(saveState, 5000); 
    showToast(`Welcome ${currentState.name}`, "success");
    toggleFS();
}

/* =========================================
   3. AUTO-SAVE & RESUME LOGIC
   ========================================= */
function saveState() {
    if(currentState.submitted) { localStorage.removeItem(STORAGE_KEY); return; }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(currentState));
}

function loadState() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved) { currentState = JSON.parse(saved); startGame(true); }
}

function clearState() {
    localStorage.removeItem(STORAGE_KEY);
    document.getElementById('resumeBox').style.display = 'none';
    showToast("Previous session cleared.", "info");
}

/* =========================================
   4. CORE EXAM LOGIC
   ========================================= */
function renderSectionTabs() {
    const bar = document.getElementById('sectionBar');
    let html = "";
    SECTION_MAP.forEach((sec, i) => {
        let cls = "sec-tab";
        let icon = "üîí";
        if(i === currentState.secIdx) { cls += " active"; icon = "üü¢"; }
        else if(i < currentState.secIdx) { cls += " done"; icon = "‚úÖ"; }
        html += `<div class="${cls}">${icon} ${sec}</div>`;
    });
    bar.innerHTML = html;
}

function loadQuestion(idx) {
    currentState.idx = idx;
    const q = QUESTIONS[idx];
    const isHindi = document.getElementById('langBtn').innerText === "HI";
    
    // Display Question based on Language Toggle
    document.getElementById('qNumDisp').innerText = idx + 1;
    document.getElementById('qContent').innerHTML = isHindi ? (q.q_hi || q.q_en) : (q.q_en || q.q_hi);
    
    // Render Options based on Language Toggle
    let optsHtml = "";
    const correctIdx = parseInt(q.ans) - 1;
    const optsArr = isHindi ? (q.op_hi || q.op_en) : (q.op_en || q.op_hi);
    
    optsArr.forEach((opt, i) => {
        let cls = "opt";
        const myAns = currentState.answers[idx];
        if(currentState.submitted) {
            if(i === correctIdx) cls += " correct";
            else if(myAns === i) cls += " wrong";
        } else {
            if(myAns === i) cls += " sel";
        }
        optsHtml += `<div class="${cls}" onclick="selectAns(${i})">
            <div class="opt-badge">${String.fromCharCode(65+i)}</div>
            <div>${opt}</div>
        </div>`;
    });
    document.getElementById('opts').innerHTML = optsHtml;
    
    // Show Solution if submitted (HTML format)
    const expBox = document.getElementById('expBox');
    if(currentState.submitted) {
        expBox.innerHTML = `<div style="font-weight:bold; margin-bottom:10px;">SOLUTION</div>${q.solution}`;
        expBox.style.display = "block";
    } else {
        expBox.style.display = "none";
    }

    updateNavButtons();
    renderPalette();
    if(window.MathJax) MathJax.typesetPromise();
}

function selectAns(i) {
    if(currentState.submitted) return;
    currentState.answers[currentState.idx] = i;
    loadQuestion(currentState.idx);
    saveState(); 
}

function next() {
    if(currentState.idx < QUESTIONS.length - 1) {
        const nextQ = QUESTIONS[currentState.idx + 1];
        const currQ = QUESTIONS[currentState.idx];
        if(nextQ.section !== currQ.section) {
            if(!currentState.submitted) {
                if(confirm(`Finish ${currQ.section} section? You cannot return.`)) {
                    currentState.secIdx++;
                    renderSectionTabs();
                    loadQuestion(currentState.idx + 1);
                }
            } else {
                loadQuestion(currentState.idx + 1);
            }
        } else {
            loadQuestion(currentState.idx + 1);
        }
    } else {
        if(!currentState.submitted) submitTest();
    }
}

function prev() {
    const currQ = QUESTIONS[currentState.idx];
    if(currentState.idx > 0) {
        const prevQ = QUESTIONS[currentState.idx - 1];
        if(prevQ.section === currQ.section || currentState.submitted) {
            loadQuestion(currentState.idx - 1);
        } else {
            showToast("Cannot go back to previous section", "warning");
        }
    }
}

function updateNavButtons() {
    const btn = document.getElementById('nextBtn');
    if(currentState.idx === QUESTIONS.length - 1 && !currentState.submitted) {
        btn.innerText = "FINISH EXAM";
        btn.style.background = "var(--danger)";
    } else {
        btn.innerText = "Next";
        btn.style.background = "var(--primary)";
    }
}

/* =========================================
   5. TIMER & UTILS
   ========================================= */
function startTimer() {
    clearInterval(timerInt);
    timerInt = setInterval(() => {
        if(currentState.time <= 0) { submitTest(); return; }
        currentState.time--;
        const m = Math.floor(currentState.time / 60).toString().padStart(2,'0');
        const s = (currentState.time % 60).toString().padStart(2,'0');
        const el = document.getElementById('timer');
        el.innerText = `${m}:${s}`;
        if(currentState.time < 300) el.classList.add('low');
    }, 1000);
}

function showToast(msg, type="info") {
    const container = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    let icon = "‚ÑπÔ∏è";
    if(type==="success") icon = "‚úÖ"; if(type==="error") icon = "‚ùå"; if(type==="warning") icon = "‚ö†Ô∏è";
    t.innerHTML = `<span>${icon}</span> <span>${msg}</span>`;
    container.appendChild(t);
    setTimeout(() => t.remove(), 3000);
}

function togglePalette() { document.getElementById('palettePanel').classList.toggle('show'); }
function renderPalette() {
    const grid = document.getElementById('paletteGrid'); grid.innerHTML = "";
    QUESTIONS.forEach((q, i) => {
        const myAns = currentState.answers[i];
        let cls = "qbtn";
        if(i === currentState.idx) cls += " current";
        if(myAns !== null) cls += " answered";
        else if(currentState.review[i]) cls += " review";
        const isAccessible = currentState.submitted || (i >= secIndices[currentState.secIdx] && (currentState.secIdx === SECTION_MAP.length -1 || i < secIndices[currentState.secIdx+1]));
        const btn = document.createElement('button');
        btn.className = cls; btn.innerText = i + 1;
        if(isAccessible) btn.onclick = () => loadQuestion(i);
        else btn.style.opacity = "0.3";
        grid.appendChild(btn);
    });
}
function markReview() { currentState.review[currentState.idx] = !currentState.review[currentState.idx]; loadQuestion(currentState.idx); }
function clearResponse() { currentState.answers[currentState.idx] = null; loadQuestion(currentState.idx); }
function toggleTheme() { document.body.classList.toggle('dark-mode'); }
function toggleFS() { !document.fullscreenElement ? document.documentElement.requestFullscreen() : document.exitFullscreen(); }
function toggleLang() { 
    const btn = document.getElementById('langBtn');
    btn.innerText = btn.innerText === "HI" ? "EN" : "HI";
    loadQuestion(currentState.idx);
}

/* =========================================
   6. SUBMIT & ANALYTICS
   ========================================= */
function submitTest() {
    if(!currentState.submitted) { if(!confirm("Are you sure you want to Submit Final Exam?")) return; }
    currentState.submitted = true; clearInterval(timerInt); saveState();
    
    let totalScore = 0, correct = 0, wrong = 0, skipped = 0;
    let sectionScores = {}; 
    QUESTIONS.forEach((q, i) => {
        const secName = q.section.replace(/[0-9]/g, '').trim();
        if(!sectionScores[secName]) sectionScores[secName] = {c:0, w:0};
        const correctIdx = parseInt(q.ans) - 1;
        const myAns = currentState.answers[i];
        if(myAns === null) skipped++;
        else if(myAns === correctIdx) { correct++; totalScore += 1; sectionScores[secName].c++; } 
        else { wrong++; totalScore -= 0.25; sectionScores[secName].w++; }
    });

    const html = `
        <div class="dashboard-grid">
            <div class="stat-box"><div style="font-size:14px; color:var(--text-muted)">Total Score</div><div class="big-num">${totalScore.toFixed(2)}</div><div style="font-size:12px">out of ${QUESTIONS.length}</div></div>
            <div class="stat-box"><div style="font-size:14px; color:var(--text-muted)">Accuracy</div><div class="big-num">${correct > 0 ? Math.round((correct/(correct+wrong))*100) : 0}%</div></div>
        </div>
        <div class="dashboard-grid"><div class="stat-box chart-wrapper"><canvas id="pieChart"></canvas></div><div class="stat-box chart-wrapper"><canvas id="barChart"></canvas></div></div>
        <div style="text-align:center; margin-top:20px;"><button onclick="downloadPDF()" class="btn-primary" style="width:auto; padding:10px 30px;">Download PDF Report</button></div>`;
    document.getElementById('resultContent').innerHTML = html;
    document.getElementById('resultModal').style.display = 'flex';
    document.getElementById('mainSubmitBtn').style.display = 'none';
    loadQuestion(0);
    renderCharts(correct, wrong, skipped, sectionScores);
}

function renderCharts(c, w, s, secData) {
    new Chart(document.getElementById('pieChart'), { type: 'doughnut', data: { labels: ['Correct', 'Wrong', 'Skipped'], datasets: [{ data: [c, w, s], backgroundColor: ['#16a34a', '#dc2626', '#94a3b8'] }] }, options: { plugins: { legend: { position: 'bottom' } }, maintainAspectRatio: false } });
    const labels = Object.keys(secData);
    new Chart(document.getElementById('barChart'), { type: 'bar', data: { labels: labels, datasets: [ { label: 'Correct', data: labels.map(k => secData[k].c), backgroundColor: '#16a34a' }, { label: 'Wrong', data: labels.map(k => secData[k].w), backgroundColor: '#dc2626' } ] }, options: { scales: { x: { stacked: true }, y: { stacked: true } }, maintainAspectRatio: false } });
}

function downloadPDF() { const el = document.getElementById('resultContent'); html2pdf().from(el).save('Exam_Report.pdf'); }
function closeResult() { document.getElementById('resultModal').style.display = 'none'; }
</script>
</body>
</html>
